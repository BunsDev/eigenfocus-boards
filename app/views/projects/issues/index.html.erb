<% set_page_title(:project_all_issues, project_name: current_project.name) %>


<%= render partial: 'projects/navigation_header', locals: {
  project: current_project
} %>

<% if @open_issue.present? %>
  <%= render partial: 'issues/issue_detail', locals: {
    issue: @open_issue,
    project: current_project
  } %>
<% else %>
  <%= turbo_frame_tag('issue') {} %>
<% end %>

<%= turbo_frame_tag 'issues', data: { turbo_action: "advance" } do %>
  <%= render partial: 'filter', locals: { q: @q } %>

  <div class="flex flex-col gap-3 lg:gap-6 flex-wrap justify-stretch">
    <% if @issues.empty? %>
      <div class="bg-body-contrast rounded-md border border-background-200 p-4 space-y-4 shadow-xs items-center">
        <p class='text-center text-readable-content-500'>
          <%= t("zero_records", resource_name: Issue.model_name.human) %>
        </p>
        <p class="mt-3 text-center mb-4">
          <%= link_to t('click_here_to_create_one'), "link", class: "btn-primary inline-block", data: { turbo_frame: 'issue' } %>
        </p>
      </div>
    <% else %>
      <table class="table-primary table-striped">
        <thead class="text-xs font-semibold uppercase ">
          <tr>
            <th><%= sort_link(@q, :title, Issue.human_attribute_name(:title)) %></th>
            <th><%= Issue.human_attribute_name(:labels) %></th>
            <th><%= sort_link(@q, :created_at, Issue.human_attribute_name(:created_at)) %></th>
            <th><%= sort_link(@q, :updated_at, Issue.human_attribute_name(:updated_at)) %></th>
            <th><%= t(:actions, scope: :menu) %></th>
          </tr>
        </thead>
        <tbody class="text-sm divide-y">
          <% @issues.each do |issue| %>
            <%= render partial: 'issue', locals: { issue: issue, project: current_project } %>
          <% end %>
        </tbody>
      </table>

      <%== pagy_summary(@pagy) %>
    <% end %>
  </div>
<% end %>
