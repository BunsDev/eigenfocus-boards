<%= turbo_frame_tag 'issue_detail' do %>
  <%= start_pending_app_tour_tag("issues/detail") %>
  <%
    data = {
      controller: "issue-detail",
      action: "modal:closed@window->issue-detail#goBackHistory",
      "issue-detail-submit-on-title-change-value": local_assigns[:submit_on_title_change],
      "issue-detail-path-for-modal-closed-value": local_assigns[:back_path]
    }
  %>

  <% data.merge!("issue-detail-attach-path-value": attach_issue_file_path(issue)) if issue.persisted? %>

  <%= render_modal(inner_container_options: {
    class: "max-h-screen w-full max-w-3xl relative cpy-issue-detail",
    data: data
  }) do %>
    <div data-controller="dropzone" data-action="dropzone:complete->issue-detail#fileUploadCompleted">
      <div class="border-b border-background-200 pb-2 mb-4">
        <div class="flex items-center space-x-2">
          <div class="flex h-7 w-7 items-center justify-center rounded-lg bg-primary-500/10 p-1 text-primary-500 ">
            <%= icon_for(:issues) %>
          </div>
          <h4 class="text-lg font-medium text-readable-content-700">
            <%= issue.persisted? ? "#{t("actions.edit")} #{Issue.model_name.human}" : "#{t("actions.create")} #{Issue.model_name.human}"%>
          </h4>
          <% if issue.archived? %>
            <span class="inline-block rounded-full border-warning-600 bg-warning-200 text-warning-800 border py-1 px-3 text-xs font-medium text-warning-600">
              <%= t('archived').capitalize %>
            </span>
          <% end %>
        </div>
      </div>
      <div class="flex flex-col md:flex-row gap-8">

        <%= render partial: 'issues/issue_detail/main_form', locals: { issue:, form_path: local_assigns[:form_path] } %>
        <%= render partial: 'issues/issue_detail/right_sidebar', locals: { issue: } %>

      </div>
    </div>
  <% end %>
<% end %>
